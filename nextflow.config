/*
 * nextflow.config  – local Docker execution
 * Optimized for GCP VM: 64 CPUs · 412 GB RAM
 */

process {
  executor      = 'local'
  cpus          = 62
  memory        = '400 GB'
  errorStrategy = 'finish'
}

/* ---------  workflow-level parameters  --------- */
params {
  /* path to directory containing FASTA assemblies (.fasta) */
  input        = '/home/peerah/contextual'

  /* where all results are written */
  resultsDir   = '/home/peerah/contextual/results'

  /* resource knobs used inside the pipeline - optimized for your GCP VM */
  threads      = 48        // Use most of your 64 CPUs for PopPUNK processes
  ram          = '200 GB'  // Use about half your RAM for PopPUNK processes

  /* Mash settings for the pre-clustering step */
  mash_k       = 21
  mash_s       = 1000
  mash_thresh  = 0.02      // 0.02 ~ 98 % ANI (more stringent for better separation)
  
  /* PopPUNK 2.7.x specific settings */
  poppunk_stable       = 'core'   // Use --stable {core,accessory,False} for consistent cluster IDs
  poppunk_reciprocal   = true     // Use --reciprocal-only for better lineage fitting
  poppunk_max_search   = 10       // --max-search-depth for deeper search
  poppunk_count_unique = true     // --count-unique-distances for better accuracy
  
  /* PopPUNK QC settings for poppunk_assign --run-qc */
  poppunk_max_zero_dist = 1       // --max-zero-dist: max zero distances allowed
  poppunk_max_merge     = 3       // --max-merge: max merge operations
  poppunk_length_sigma  = 2       // --length-sigma: outlying genome length detection
}

/* -------------  container runtime -------------- */
docker {
  enabled    = true        // run every process in its declared Docker image
  runOptions = ''          // add custom flags here if needed
}

singularity.enabled = false   // ensure Singularity isn’t used

/* -------------  reporting / visualisation ------ */
report.enabled   = true   // HTML run report
timeline.enabled = true   // Gantt chart
dag.enabled      = true   // DAG PNG

